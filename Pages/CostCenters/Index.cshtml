@page
@model EstoqueApp.Pages.CostCenters.IndexModel
@{
	Layout = "_LayoutNovo";
}

<!-- Header da página -->
<div class="flex items-center justify-between mb-6">
	<div>
		<h1 class="text-3xl font-bold text-gray-800">Centros de Custo</h1>
		<p class="text-gray-500">Centros de custo</p>
	</div>
	<a class="flex items-center gap-2 bg-[#16559F] text-white px-4 py-2 rounded-md hover:bg-gray-300" asp-page="AddProduct">
		+ Novo CC
	</a>
</div>

<!-- Barra de busca e filtros -->
<form method="get" asp-page="./?skip=0&take=5" class="mb-6 bg-white p-8 shadow-md rounded-lg">

	<div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">

		<!-- Dropdown -->
		<div class="md:col-span-2">
			<label class="block text-sm font-medium text-gray-700 mb-1">Centro de custo</label>
			<select asp-for="SelectedCostCenterId"
					asp-items="Model.CostCenters"
					onchange="this.form.submit()"
					class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring focus:ring-blue-200 focus:border-blue-500">
			</select>
		</div>

		<!-- Ações -->
		<div class="flex gap-2 justify-end">
			<a class="bg-[#009587] text-white px-4 py-2 rounded-md hover:bg-[#00796B]"
			   asp-page="EditCostCenter" asp-route-id="@Model.SelectedCostCenterId">
				Editar
			</a>

			<button type="button"
					onclick="openModal(this)"
					class="bg-[#DB0F19] text-white px-4 py-2 rounded-md hover:bg-red-700"
					data-id="@Model.SelectedCostCenterId"
					data-handler="Delete"
					data-message="Deseja realmente excluir o centro de custo @Model.SelectedCostCenterId ?">
				Excluir
			</button>
		</div>
	</div>
</form>

<!-- Lista de produtos -->
<div class="relative overflow-x-auto shadow-md rounded-lg">
	<table class="w-full text-sm text-left text-gray-500">
		<thead class="text-xs text-gray-700 uppercase bg-gray-50">
			<tr>
				<th scope="col" class="px-6 py-3">Produtos </th>
				<th scope="col" class="px-6 py-3">Quantidade</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var stockCC in Model.StockByCCs)
			{
				<tr class="odd:bg-white even:bg-gray-50 border-b hover:bg-gray-300">
					<td class="px-6 py-4 font-medium text-gray-900">@stockCC.Product.Name</td>
					<td class="px-6 py-4">@stockCC.Product.CurrentStock</td>
				</tr>
			}
		</tbody>

	</table>
</div>

<!-- Paginação -->
<div class="flex justify-center items-center gap-4 mt-4">
	<!-- Botão anterior -->
	@if (Request.Query.ContainsKey("skip") && int.Parse(Request.Query["skip"]) > 0)
	{
		var previousSkip = Math.Max(0, int.Parse(Request.Query["skip"]) - 5);
		<a asp-page="./Index"
		   asp-route-skip="@previousSkip"
		   asp-route-take="5"
		   asp-route-SelectedCostCenterId="@Model.SelectedCostCenterId"
		   class="px-4 py-2 bg-gray-200 rounded hover:bg-[#16559F] hover:text-white text-gray-700">
			← Anterior
		</a>
	}
	else
	{
		<span class="px-4 py-2 bg-gray-100 text-gray-400 rounded">← Anterior</span>
	}

	<!-- Botão próximo -->
	@if (Model.StockByCCs.Count == 5)
	{
		var nextSkip = Request.Query.ContainsKey("skip") ? int.Parse(Request.Query["skip"]) + 5 : 5;
		<a asp-page="./Index"
		   asp-route-skip="@nextSkip"
		   asp-route-take="5"
		   asp-route-SelectedCostCenterId="@Model.SelectedCostCenterId"
		   class="px-4 py-2 bg-gray-200 rounded hover:bg-[#16559F] hover:text-white text-gray-700">
			Próximo →
		</a>
	}
	else
	{
		<span class="px-4 py-2 bg-gray-100 text-gray-400 rounded">Próximo →</span>
	}
</div>

<partial name="./Shared/_ConfirmModalPartial" />

@section Scripts {
	<script>
		// Toggle dropdown manualmente (sem Flowbite, só JS simples)
		document.getElementById("dropdownButton").addEventListener("click", function () {
			document.getElementById("dropdownMenu").classList.toggle("hidden");
		});
	</script>
}